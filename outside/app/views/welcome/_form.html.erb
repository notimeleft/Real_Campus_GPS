<script src="//maps.google.com/maps/api/js?v=3.22&libraries=geometry" type="text/javascript"></script>
<script src="//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js" type="text/javascript"></script>

<div style='width: 800px;'>
  <div id="map" style='width: 1000px; height: 600px;'></div>
</div>

<script type="text/javascript">
  var anumber = 1
  var handler = Gmaps.build('Google');
     handler.buildMap({ internal: {id: 'map'}}, function(){
       var plan = <%= raw @result %>;
       plan.options = {
         geodesic: true,
         strokeColor: '#FF0000',
         strokeOpacity: 1.0,
         strokeWeight: 4,
         title: 'plan'
       };


       function addPolyline(polyline){
         var transformedPolyline = _.map(polyline, function(coordinates){
           return { lat: coordinates[0], lng: coordinates[1] };
         })
         handler.addPolyline(transformedPolyline, polyline.options);
         handler.bounds.extend(transformedPolyline[0]);
         handler.bounds.extend(polyline[ polyline.length - 1]);
       }

       addPolyline(plan);
       handler.fitMapToBounds();
     });
</script>
